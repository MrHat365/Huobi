<!DOCTYPE html>
<html dir="ltr" lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="shortcut icon" type="image/x-icon" href="public/images/logo.png">
    <title>提交请求 帮助中心</title>
    <!-- 引入样式 -->
    <link href="public/css/bootstrap.min.css" rel="stylesheet" />
    <link href="public/css/style.css" rel="stylesheet" />
    <link href="public/css/request.css" rel="stylesheet" />
    <link href="/public/css/toastr.min.css" rel="stylesheet" />
</head>

<body>
    <div id="all">
        <header class="header">
            <div class="logo">
                <a href="index.html">
                    <img src="public/images/huobi.png" height="37" alt="logo">
                </a>
            </div>
            <div class="nav-wrapper">
                <span class="icon-menu"></span>
                <nav class="user-nav" id="user-nav">

                    <a class="submit-a-request" href="requests.html">提交请求</a>
                </nav>
            </div>
        </header>

        <main role="main">
            <div class="container-divider"></div>
            <div class="container">
                <nav class="sub-nav">
                    <ol class="breadcrumbs">

                        <li title="帮助中心">

                            <a href="index.html">帮助中心</a>

                        </li>

                        <li title="提交请求">

                            提交请求

                        </li>

                    </ol>

                    <form role="search" class="search" action="/search.html" accept-charset="UTF-8" method="get"><input
                            type="search" name="query" id="query" placeholder="搜索" aria-label="搜索" /></form>
                </nav>

                <h1>
                    提交请求

                </h1>

                <div class="form">
                    <form id="new_request" class="request-form" data-form="" data-form-type="request" action="#"
                        accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input
                            type="hidden" name="authenticity_token"
                            value="hc:requests:server:TOi6mUtsRXeISMMbTdoo35pBZXfIYDvT83Ufbhmvb4/KVkxSax4rXhIGVgs6NbtYRfR7lmMZe6GvaHukqwgnsg==" />

                        <div class="form-field select optional request_ticket_form_id"><label
                                for="request_issue_type_select">Please choose your issue below</label>
                            <select id="request_issue_type_select" onchange="requests(this.value)">
                                <option value="1">-
                                </option>
                                <option value="2">PRO工单
                                </option>
                                <option value="3" selected>OTC工单
                                </option>
                            </select></div>

                        <div id="emailAdd" class="form-field string required"><label
                                for="request_anonymous_requester_email">电邮地址</label>
                            <input type="text" name="email" id="email" aria-required="true" />
                        </div>

                        <div class="form-field text  required  request_description">
                            <label id="request_description_label" for="request_description">描述</label>
                            <textarea name="content" id="content" aria-required="true"
                                aria-describedby="request_description_hint" aria-labelledby="request_description_label">
            </textarea>

                            <p id="request_description_hint">请提供您的火币账户及问题详细描述，工单会在24小时内回复，谢谢配合！Please submit your Huobi
                                account and the details of your request. The ticket will be replied in 24 hours. Thanks!
                            </p>
                        </div>

                        <div class="form-field">
                            <label for="request-attachments">附件</label>
                            <div id="upload-dropzone" class="upload-dropzone">
                                <input type="file" multiple="true" id="request-attachments" data-fileupload="true"
                                    data-dropzone="upload-dropzone" data-error="upload-error"
                                    data-create-url="/hc/zh-cn/request_uploads" data-name="request[attachments][]"
                                    data-pool="request-attachments-pool" data-delete-confirm-msg="" />
                                <span>
                                    <a>添加文件</a>或把文件放置到这里
                                </span>
                            </div>

                            <div id="upload-error" class="notification notification-error notification-inline">
                                <span data-upload-error-message></span>
                            </div>

                            <ul id="request-attachments-pool" class="upload-pool" data-template="upload-template"></ul>

                            <script type="text/html" id="upload-template">
                                <li class="upload-item" data-upload-item>
                                    <a class="upload-link" target="_blank" data-upload-link></a>
                                    <p class="upload-path" data-upload-path></p>
                                    <p class="upload-path" data-upload-size></p>
                                    <p data-upload-issue class="notification notification-alert notification-inline"
                                        aria-hidden="true"></p>
                                    <span class="upload-remove" data-upload-remove></span>
                                    <div class="upload-progress" data-upload-progress></div>
                                    <input type="hidden">
                                </li>
                            </script>

                        </div>

                        <footer><input @click="selUser" type="button" name="commit" value="提交" />
                            <script src="https://www.recaptcha.net/recaptcha/api.js" async defer></script>
                            <div data-size="invisible" data-sitekey="6Ldm2WgUAAAAAJ0tKm0JAq-vewBfYR2yhQmPknA2"
                                data-badge="inline" data-callback="invisibleRecaptchaSubmit" class="g-recaptcha "
                                ui="invisible"></div>
                        </footer>

                    </form>

                </div>

            </div>

        </main>

        <!-- 底部 -->
        <div class="footer">
            <div class="footer-inner">
                <a title="主页" href="index.html">帮助中心</a>

                <div class="footer-language-selector">

                    <div class="dropdown language-selector" aria-haspopup="true">
                        <div class="row clearfix">
                            <div class="col-md-12 column">
                                <div class="btn-group dropup">
                                    <button style="border: none;" class="btn btn-default" data-toggle="dropdown"
                                        style="color:#4f6d8c ;">简体中文&nbsp;<img
                                            src="/public/images/xiangxia.svg" /></button>
                                    <ul class="dropdown-menu" style="margin-left: -75px;">
                                        <li v-for="l in langua">
                                            <a href="javascript:;"> {{l.name}} </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="public/js/jquery.min.js"></script>
<script src="public/js/bootstrap.min.js"></script>
<script src="public/js/snippet.js"></script>
<script src="public/js/script.js"></script>
<script src="public/js/vue.min.js"></script>
<script src="public/js/vue-resource v1.5.1.js"></script>
<script src="/public/js/huobi-socket.js"></script>
<script src="/public/js/toastr.min.js"></script>
<script src="/public/js/cookie.js"></script>

<script>
    // 新增公告web socket推送
    var socket = new HuobiSocket('wss://huobi.xis7707.com/ws')
    socket.connect();
    socket.on("Notification", function (data) {
        console.log(data);
        toastr.success(data.data);
    });

    var typeId;
    $(function () {
        //获取路径传输的值
        var url = location.search;
        if (url.indexOf("?") != -1) {
            typeId = url.substr(1);
        }

        new Vue({
            el: "#all",
            data: {
                langua: [] //语言信息
            },
            methods: {
                //未登录 提交工单
                subRequestGET() {
                    var email = $("#email").val();
                    var content = $("#content").val();
                    console.info(email, content)
                    // 邮箱正则表达式
                    var reg =
                        /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
                    //非空判断
                    if (email.trim() == "" || !reg.test(email)) {
                        toastr.error("电邮 格式有误");
                    } else if (content.trim() == "") {
                        toastr.error("描述 不能空白");
                    } else {
                        $.ajax({
                            url: "https://huobi.xis7707.com/api/tickets/publish",
                            type: "post",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            data: JSON.stringify({
                                Email: email,
                                Content: content,
                                TypeId: typeId
                            }),
                            success: (data) => {
                                toastr.success("提交请求成功！");
                                setTimeout(() => {
                                    location.href = "index.html";
                                }, 3000);
                            }
                        });
                    }
                },
                //登录状态下 提交工单
                subRequestPost() {
                    //非空判断
                    var content = $("#content").val();
                    if (content.trim() == "") {
                        toastr.error("描述 不能空白");
                    } else {
                        $.ajax({
                            url: "https://huobi.xis7707.com/api/tickets/publish-auth",
                            type: "post",
                            headers: {
                                "Content-Type": "application/json",
                                "Authorization": "Bearer " + getCookie("token") //判断登录成功的关键
                            },
                            data: JSON.stringify({
                                Content: content,
                                TypeId: typeId
                            }),
                            success: (data) => {
                                toastr.success("提交请求成功！");
                                setTimeout(() => {
                                    location.href = "req.html";
                                }, 3000);
                            }
                        })
                    }
                },
                // 获取用户信息（判断是否登录）
                selUser() {
                    $.ajax({
                        url: "https://huobi.xis7707.com/api/users/info",
                        type: "post",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": "Bearer " + getCookie("token") //判断是否登录成功的关键
                        },
                        success: (data) => {
                            console.info(data)
                            //如果有登录信息 隐藏电邮地址
                            $("#emailAdd").css("display", "none");
                            //如果有登录信息 执行此方法
                            this.subRequestPost();
                        },
                        error: (data) => {
                            console.info(data.status)
                            if (data.status == "401") {
                                //401为未登录，则执行此方法
                                this.subRequestGET();
                            }
                        }
                    })
                },
            },
            mounted: function () {
                //获取语言列
                $.ajax({
                    url: "https://huobi.xis7707.com/api/lang",
                    type: "get",
                    success: (data) => {
                        console.info(data.data);
                        this.langua = data.data;
                    }
                });

                //登录信息
                $.ajax({
                    url: "https://huobi.xis7707.com/api/users/info",
                    type: "post",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer " + getCookie("token") //判断是否登录成功的关键
                    },
                    success: (data) => {
                        console.info(data)
                        //如果有登录信息 隐藏电邮地址
                        $("#emailAdd").css("display", "none");
                    }
                })
            }
        });
    });

    // 请求页面互相跳转
    function requests(obj) {
        if (obj == 1) {
            location.href = "/requests.html";
        }
        if (obj == 2) {
            location.href = "/request-pro.html?400001";
        }
        if (obj == 3) {
            location.href = "/request-otc.html?400002";
        }
    }
</script>

</html>